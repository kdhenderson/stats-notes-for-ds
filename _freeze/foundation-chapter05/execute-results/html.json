{
  "hash": "906d81f18cc05bfc70216b230604e15f",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Alternatives to the T-Tools\"\n---\n\n\n\n\n## Objectives\n\n- Recognize when the assumptions of the *t*-tools are violated or when these tools are inappropriate.\n- Understand the logic and implementation of rank-based and permutation-based alternatives.\n- Apply and interpret the results of nonparametric tests, including the rank-sum test, signed-rank test, and permutation test.\n\n\n## Nonparametric Methods\n\nNonparametric methods provide a solution when assumptions of the *t*-test cannot be met, such as:\n\n- Severe skewness in the data.\n- Large differences in variances between groups.\n- Small sample sizes that preclude assumptions about the population distribution.\n\n\n## Censored Data\n\nCensored data occurs when the exact value of an observation is unknown, often due to exceeding a measurement threshold (e.g., students taking longer than the maximum allowed time to complete a test).\n\nRank-based tests, such as the rank-sum test, rely on the ordering of data rather than specific values, making them robust to censored observations.\n\n## Permutation Test\n\nA permutation test is a flexible, nonparametric alternative to the two-sample *t*-test.\n\n**Assumptions**:\n\n- The null hypothesis is true, and all permutations (random shufflings) of the data are equally likely under the null.\n- The test does *not* assume normality.\n- The null distribution is generated by repeatedly permuting the observed data.\n\n**Procedure**:\n\n1. Combine all $n + m$ observations from the two groups.\n2. Randomly reassign labels to simulate permutation under $H_0$.\n3. Compute a test statistic (e.g., mean, median, or ratio) for each permutation.\n4. Compare the observed test statistic to the permutation distribution.\n\n**Applications**:\n\n- Suitable for small or non-normal datasets, especially when there are ties.\n- Effective for a wide range of statistics including means, medians, and ratios.\n- Not appropriate when the data have an inherent order that must be preserved.\n  \n\n## Wilcoxon Rank-Sum Test\n\n**Purpose**:\n\n- A distribution-free method for comparing two independent samples.\n- Particularly useful with small samples, where normality assumptions cannot be assessed.\n- Resistant to outliers.\n- Capable of handling censored observations.\n\n**Hypothesis**:\n\n- $H_0$: The two populations have equal medians.\n\n**Procedure**:\n\n1. Combine all observations and rank them (assign average ranks for ties).\n2. Compute the rank sum for one group (typically the smaller group, for ease of computation).\n   - This rank sum serves as the test statistic.\n3. Compute the *p*-value:\n   - **Exact Method**:\n     - Evaluate all possible permutations of ranks under $H_0$ to generate the exact distribution of rank sums.\n     - Compute the proportion of permutations with rank sums as or more extreme than the observed value.\n       - The number of rank sums greater than or equal to the observed value divided by the total number of permutations\n     - Equivalent to a permutation test on the rank sum statistic, rather than the difference in means.\n     - Not computationally feasible for large $n$.\n   - **Normal Approximation**:\n     - For larger samples (with few ties), the rank sum statistic approximates a normal distribution.\n     - Compute a *Z*-statistic using:\n       $$\n       Z = \\frac{T - \\text{Mean}(T)}{\\text{SD}(T)}\n       $$\n       Where:\n       - $T$: The observed rank sum.\n       - $\\text{Mean}(T) = n_1 \\bar{R}$, with $\\bar{R}$ the average rank of all combined observations.\n       - $\\text{SD}(T) = s_R \\sqrt{ \\frac{n_1 n_2}{n_1 + n_2} }$, where $s_R$ is the standard deviation of all ranks.\n     - Apply a **continuity correction** to improve *p*-value accuracy:\n       - Add 0.5 to $T$ for a **left-tailed** test.\n       - Subtract 0.5 from $T$ for a **right-tailed** test.\n     - This correction improves the match between the discrete statistic and the continuous normal curve.\n\n**Confidence Intervals**:\n\n- Use the **Hodges–Lehmann estimator** to construct a confidence interval for the difference in medians.\n\n### Visualizing the Continuity Correction\n\nWhen the rank sum distribution is approximated by a normal curve, a continuity correction adjusts for the fact that $T$ is discrete.\n\n**Conceptually**:\n\n- The rank sum statistic creates a histogram-like distribution (discrete bars).\n- Exact *p*-values are based on shaded bar areas beyond a cutoff.\n- The normal approximation uses a smooth curve instead.\n- The continuity correction shifts the normal cutoff to the center of the bar, improving the approximation.\n\n![**How continuity correction improves normal approximation.**  \nIllustration of continuity correction in a rank-based test. The gray bars show the exact (discrete) distribution of the test statistic. The black curve represents the normal approximation. The dashed vertical line at 7 is the unadjusted threshold; the dotted red line at 7.5 shows the continuity-corrected threshold, which more accurately aligns the area under the normal curve (red shaded) with the area of the histogram bars.](images/fch05_continuity_correction.png)\n\n\n## Alternatives to the Paired *t*-Test\n\n### Wilcoxon Signed-Rank Test\n**Hypothesis**:\n\n- $H_0$: The median difference between paired observations is zero.\n- Consider direction for one-sided tests.\n\n**Procedure**:\n\n1. Compute differences between pairs.\n2. Rank *absolute* differences and sum ranks of positive values.\n3. Compute *p*-value using:\n   - **Exact Test**: All permutations of rank assignments.\n   - **Normal Approximation**:\n     $$\n     \\text{Mean}(S) = \\frac{n(n+1)}{4}, \\quad\n     \\text{SD}(S) = \\sqrt{\\frac{n(n+1)(2n+1)}{24}}, \\quad\n     Z = \\frac{S - \\text{Mean}(S)}{\\text{SD}(S)}\n     $$\n   - ***p*-Value**: Derived from software or *Z*-tables.   \n\n**Notes on the Signed-Rank Test**:\n\n- Resistant to outliers.  \n- Retains information on both the magnitude and direction of differences.  \n- More powerful than the sign test, especially when magnitude matters.\n\n::: {.example}\n\n### Wilcoxon Signed-Rank Test Example\n**Scenario**: An employer compares mileage from a 5-day and 4-day work week for 7 employees. The goal is to test whether mileage is lower under the 4-day week (i.e., higher under the 5-day week).\n\n**Hypotheses**:\n\n- $H_0$: $\\text{mileage}_5 = \\text{mileage}_4$\n- $H_a$: $\\text{mileage}_5 > \\text{mileage}_4$ (one-sided)\n\n| Employee | 5-day Mileage | 4-day Mileage | Difference ($d$) | Rank | $d > 0$? |\n|----------|---------------|---------------|------------------|------|----------|\n| 1        | —             | —             | $-119$           | 1    | No       |\n| 2        | —             | —             | $1612$           | 6    | Yes      |\n| 3        | —             | —             | $1328$           | 5    | Yes      |\n| 4        | —             | —             | $-264$           | 2    | No       |\n| 5        | —             | —             | $1311$           | 4    | Yes      |\n| 6        | —             | —             | $3110$           | 7    | Yes      |\n| 7        | —             | —             | $-467$           | 3    | No       |\n\n**Test Statistic**:\n\n- $S = \\text{sum of ranks for positive differences} = 6 + 5 + 4 + 7 = 22$\n\n**Normal Approximation** (used since $n = 7$ is moderately small but adequate):\n\n- Mean:\n  $$\n  \\text{Mean}(S) = \\frac{n(n+1)}{4} = \\frac{7(8)}{4} = 14\n  $$\n  - Interpretation: if $H_0$ is True then $S$ should be $\\approx 14$\n- Standard deviation:\n  $$\n  \\text{SD}(S) = \\sqrt{\\frac{n(n+1)(2n+1)}{24}} = \\sqrt{\\frac{7(8)(15)}{24}} \\approx 5.92\n  $$\n- Apply continuity correction:\n  $$\n  Z = \\frac{S - 0.5 - \\text{Mean}(S)}{\\text{SD}(S)} = \\frac{22 - 0.5 - 14}{5.91} \\approx 1.27\n  $$\n\n- One-sided *p*-value:\n  $$\n  P(Z > 1.27) \\approx 0.1024\n  $$\n\n- Interpretation: There is insufficient evidence to reject $H_0$ at a typical 0.05 level.\n\n![**Normal approximation to the Wilcoxon signed-rank test statistic $S$ with continuity correction.** \nThe curve represents the null distribution with $\\text{Mean}(S) = 14$ and $\\text{SD}(S) \\approx 5.92$. The dashed line at $S = 22$ is the observed value; the dotted line at $S - 0.5 = 21.5$ reflects the continuity-corrected value. The shaded region corresponds to a one-sided *p*-value of approximately 0.1024, indicating insufficient evidence to reject $H_0$.](images/fch05_signed_rank_normal_approx.png)\n\n:::\n\n### Sign Test\n**Purpose**:\n\n- A simple alternative to the paired *t*-test.\n- Tests for a median difference between paired observations.\n- Less powerful than signed-rank or permutation tests.\n\n**Procedure**:\n\n1. Compute the paired differences.\n2. Count the number of positive differences ($K$).\n\n**Hypothesis**:\n\n- $H_0$: $K = \\frac{n}{2}$ (half of differences are positive under $H_0$).\n\n**Normal Approximation** (for large $n$):\n\n$$\nZ = \\frac{K - 0.5 - \\frac{n}{2}}{\\sqrt{\\frac{n}{4}}}\n$$\n\n- 0.5 is a continuity correction.\n- $\\sqrt{n/4}$ is the standard deviation of $K$ under $H_0$.\n\n\n## Levene’s (Median) Test of Equal Spread\n\n**Purpose**:\n\n- Robust alternative to the *F*-test for comparing group variances.\n- Helpful when data is non-normal.\n- Initial visualization (e.g., boxplots) is still recommended.\n\n**Hypothesis**:\n\n- $H_0$: Groups have equal spread (variance).\n- $H_a$: At least one group differs in spread.  \n\n**Procedure**:\n\n1. For each observation, compute the **absolute deviation** from the group median:\n   $$\n   |\\text{observation} - \\text{group median}|\n   $$\n2. Conduct a two-sample *t*-test (or ANOVA) on these deviations.\n3. Interpret the results:\n   - Reject $H_0$ if the *p*-value is below the significance threshold, indicating unequal spread.\n\n> Notes:\n  - In SAS:\n    - The **Brown–Forsythe Test** (median-based variant) can be run with `proc glm`.\n    - Levene's test (mean- or median-based) is also available in `proc glm`.\n\n\n## Code Examples\n\n### Signed-Rank and Sign Tests in SAS\n\n\n\n::: {.cell}\n\n```{.sas .cell-code}\n/* Paired nerve cell density comparison in horses */\n\ndata horse;\ninput horse site1 site2;\ndatalines;\n6 14.2 16.4\n4 17 19\n8 37.4 37.6\n5 11.2 6.6\n7 24.2 14.4\n9 35.2 24.4\n3 35.2 23.2\n1 50.6 38\n2 39.2 18.6\n;\n\n/* Check that the data were read correctly */\nproc print data=horse;\nrun;\n\n/* Run a paired t-test */\n/* Assumption of normality may be violated because the sample size is small */\nproc ttest data=horse;\npaired site1*site2;\nrun;\n\n/* Set up for nonparametric tests\n   H0: Median difference between site1 and site2 = 0\n   HA: Median difference ≠ 0 (two-sided)\n       or Median difference > 0 (one-sided) */\n\n/* Compute difference between paired values */\ndata horse2;\nset horse;\ndiff = site1 - site2;\nrun;\n\n/* Check new dataset with the computed differences */\nproc print data=horse2;\nrun;\n\n/* Run a signed-rank test (incorporates both sign and magnitude of differences)\n   Note: PROC UNIVARIATE runs:\n     - paired t-test\n     - sign test\n     - signed-rank test */\nproc univariate data=horse2;\nvar diff;\nrun;\n\n/* Conclusion:\n   There is strong evidence that the median difference in nerve cell density\n   between sites is greater than zero\n   (p = 0.0294, one-sided Wilcoxon signed-rank test). */\n\n```\n:::\n\n\n\n\n### Signed-Rank Test in R\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Wilcoxon signed-rank test in R\n# H0: median difference = 0\n# HA: median difference ≠ 0 (or > 0 if one-sided)\n\nwilcox.test(horse$site1, horse$site2, paired = TRUE)\n```\n:::\n\n\n\n\n### Levene's Test in SAS\n\n\n\n::: {.cell}\n\n```{.sas .cell-code}\n/* Test prep example: Comparing spread of scores across teaching styles */\n\ndata exam;\ninput score type $;\ndatalines;\n37 New\n49 New\n55 New\n77 New\n23 Trad\n31 Trad\n46 Trad\n;\n\n/* Levene’s test (Brown–Forsythe variant based on medians) */\nproc glm data=exam;\nclass type;\nmodel score = type;\nmeans type / hovtest=bf; /* hov = homogeneity of variance; bf = Brown–Forsythe */\nrun;\n\n/* Manual demonstration of Brown–Forsythe:\n   Calculate absolute deviations from group medians */\n\ndata medianDiff;\ninput diff type $;\ndatalines;\n15 New\n3 New\n3 New\n25 New\n8 Trad\n0 Trad\n15 Trad\n;\n\n/* A t-test on the deviations (diff) should match the Brown–Forsythe result */\nproc ttest data=medianDiff;\nclass type;\nvar diff;\nrun;\n\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}